<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì˜¬í•´ì˜ 00 ê²°ì‚° ë„ìš°ë¯¸</title>

  <style>
    :root{
      /* ğŸ„ Red / White Holiday Theme */
      --bg:#fff6f7;
      --card:#ffffff;

      --text:#1b1b1b;
      --muted:#5d5d5d;

      --line:rgba(0,0,0,.08);

      --red:#d12b2b;        /* main */
      --red2:#ff4a4a;       /* highlight */
      --white:#ffffff;

      --accent:var(--red);
      --accent2:var(--red2);

      --danger:#d12b2b;
      --ok:#0c8f47;         /* (í† ìŠ¤íŠ¸ ì /OK í‘œì‹œë§Œ) */

      --shadow: 0 16px 50px rgba(0,0,0,.08);
      --r: 18px;
      --pad: 18px;

      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
        "Noto Sans KR", AppleSDGothicNeo, "Malgun Gothic", Arial, sans-serif;
    }

    *{ box-sizing:border-box; }

    /* âœ… ë°°ê²½: ë ˆë“œ/í™”ì´íŠ¸ íŒ¨í„´ "ì´ë¯¸ì§€" (SVG data URI) */
    body{
      margin:0;
      font-family:var(--font);
      color:var(--text);
      min-height:100vh;
      display:flex;
      justify-content:center;
      padding:24px 14px 60px;

      background:
        /* ëˆˆ/ìŠ¤ë…¸ìš° ë„íŠ¸ ë ˆì´ì–´ */
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='240' viewBox='0 0 240 240'%3E%3Crect width='240' height='240' fill='none'/%3E%3Cg fill='%23ffffff' fill-opacity='0.9'%3E%3Ccircle cx='30' cy='40' r='2'/%3E%3Ccircle cx='80' cy='90' r='1.8'/%3E%3Ccircle cx='140' cy='60' r='2.2'/%3E%3Ccircle cx='200' cy='110' r='1.6'/%3E%3Ccircle cx='50' cy='160' r='2'/%3E%3Ccircle cx='120' cy='170' r='1.6'/%3E%3Ccircle cx='210' cy='190' r='2.2'/%3E%3C/g%3E%3C/svg%3E"),
        /* ë¦¬ë³¸/ì²´í¬ ëŠë‚Œ ë ˆì´ì–´ */
        url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220' viewBox='0 0 220 220'%3E%3Crect width='220' height='220' fill='%23fff6f7'/%3E%3Cg opacity='0.16'%3E%3Cpath d='M0 40 L220 40' stroke='%23d12b2b' stroke-width='6'/%3E%3Cpath d='M0 110 L220 110' stroke='%23d12b2b' stroke-width='6'/%3E%3Cpath d='M0 180 L220 180' stroke='%23d12b2b' stroke-width='6'/%3E%3C/g%3E%3Cg opacity='0.10'%3E%3Cpath d='M40 0 L40 220' stroke='%23d12b2b' stroke-width='6'/%3E%3Cpath d='M110 0 L110 220' stroke='%23d12b2b' stroke-width='6'/%3E%3Cpath d='M180 0 L180 220' stroke='%23d12b2b' stroke-width='6'/%3E%3C/g%3E%3C/svg%3E\"),
        linear-gradient(180deg, #fff6f7 0%, #ffeef0 100%);

      background-repeat: repeat, repeat, no-repeat;
      background-size: 240px 240px, 220px 220px, cover;
      background-attachment: fixed;
    }

    .wrap{ width:min(980px, 100%); }

    header{
      display:flex;
      gap:14px;
      align-items:flex-start;
      justify-content:space-between;
      margin-bottom:18px;
    }

    .brand{ display:flex; flex-direction:column; gap:6px; }

    .title{
      font-size:22px;
      font-weight:900;
      letter-spacing:-.2px;
      margin:0;
    }

    .subtitle{
      margin:0;
      color:var(--muted);
      font-size:13px;
      line-height:1.5;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      background:rgba(255,255,255,.8);
      color:var(--muted);
      font-size:12px;
      user-select:none;
      backdrop-filter: blur(6px);
    }

    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:14px;
    }
    @media (max-width:900px){ .grid{grid-template-columns:1fr} }

    .card{
      background:rgba(255,255,255,.9);
      border:1px solid var(--line);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(8px);
    }

    .card .head{
      padding:16px var(--pad);
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .card .head h2{
      margin:0;
      font-size:13px;
      color:var(--muted);
      font-weight:800;
      letter-spacing:-.1px;
    }

    .card .body{ padding:18px var(--pad); }

    .progress{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:14px;
    }

    .bar{
      flex:1;
      height:10px;
      background:rgba(0,0,0,.06);
      border-radius:999px;
      overflow:hidden;
      border:1px solid rgba(0,0,0,.06);
    }

    .bar > i{
      display:block;
      height:100%;
      width:0%;
      background:linear-gradient(90deg, var(--accent), var(--accent2));
      border-radius:999px;
      transition:width .35s ease;
    }

    .pct{
      font-size:12px;
      color:var(--muted);
      min-width:86px;
      text-align:right;
    }

    .qbox{
      padding:16px;
      border-radius:14px;
      border:1px solid var(--line);
      background:
        radial-gradient(400px 120px at 20% 20%, rgba(209,43,43,.10), transparent 60%),
        radial-gradient(420px 140px at 80% 30%, rgba(255,74,74,.08), transparent 60%),
        rgba(255,255,255,.75);
      margin-bottom:12px;
    }

    .qnum{ color:var(--muted); font-size:12px; margin-bottom:6px; }

    .qtext{
      margin:0;
      font-size:18px;
      font-weight:900;
      letter-spacing:-.3px;
      line-height:1.35;
    }

    textarea{
      width:100%;
      min-height:110px;
      resize:vertical;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(0,0,0,.10);
      background:rgba(255,255,255,.92);
      color:var(--text);
      outline:none;
      font-size:14px;
      line-height:1.6;
    }

    textarea:focus{
      border-color:rgba(209,43,43,.45);
      box-shadow: 0 0 0 3px rgba(209,43,43,.14);
    }

    .hint{
      margin-top:8px;
      color:var(--muted);
      font-size:12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    .hint code{
      color:#1b1b1b;
      background:rgba(0,0,0,.04);
      border:1px solid rgba(0,0,0,.08);
      padding:2px 6px;
      border-radius:8px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size:12px;
    }

    .btns{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:14px;
    }

    button{
      border:1px solid rgba(0,0,0,.10);
      background:rgba(255,255,255,.92);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:900;
      font-size:13px;
      transition: transform .05s ease, background .2s ease, border-color .2s ease, opacity .2s ease;
      user-select:none;
    }

    button:hover{
      background:#ffffff;
      border-color:rgba(0,0,0,.16);
    }

    button:active{ transform: translateY(1px); }
    button:disabled{ opacity:.45; cursor:not-allowed; }

    .primary{
      color:white;
      background:linear-gradient(90deg, var(--accent), var(--accent2));
      border-color:rgba(209,43,43,.25);
    }

    .primary:hover{ filter:brightness(1.03); }

    .danger{
      color:white;
      background:linear-gradient(90deg, #b51f1f, #ff4a4a);
      border-color:rgba(209,43,43,.25);
    }

    .danger:hover{ filter:brightness(1.03); }

    .ghost{
      background:transparent;
      border-color:rgba(0,0,0,.10);
    }

    .ghost:hover{ background:rgba(255,255,255,.75); }

    .side-list{
      display:flex;
      flex-direction:column;
      gap:10px;
      max-height:520px;
      overflow:auto;
      padding-right:6px;
    }

    .item{
      border:1px solid var(--line);
      background:rgba(255,255,255,.85);
      border-radius:14px;
      padding:12px;
    }

    .item .meta{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      margin-bottom:6px;
    }

    .item .meta b{ font-size:12px; color:var(--muted); }

    .tag{
      font-size:11px;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid rgba(0,0,0,.10);
      color:var(--muted);
      background:rgba(255,255,255,.9);
      white-space:nowrap;
    }

    .ans{
      margin:0;
      font-size:13px;
      line-height:1.55;
      color:#222;
      white-space:pre-wrap;
      word-break:break-word;
    }

    .empty{ color:rgba(93,93,93,.75); font-style:italic; }

    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform:translateX(-50%);
      background:rgba(255,255,255,.95);
      border:1px solid rgba(0,0,0,.12);
      box-shadow:var(--shadow);
      color:var(--text);
      padding:10px 12px;
      border-radius:999px;
      font-size:13px;
      display:none;
      gap:10px;
      align-items:center;
      z-index:50;
      max-width:min(720px, 92vw);
    }

    .dot{
      width:9px;
      height:9px;
      border-radius:50%;
      background:var(--ok);
      box-shadow:0 0 0 3px rgba(12,143,71,.12);
      flex:0 0 auto;
    }

    .footer-tools{ margin-top:10px; display:flex; gap:10px; flex-wrap:wrap; }
    .small{ font-size:12px; color:var(--muted); line-height:1.6; margin:0; }

    details{
      border:1px solid var(--line);
      border-radius:14px;
      background:rgba(255,255,255,.85);
      padding:10px 12px;
      margin-top:12px;
    }

    summary{
      cursor:pointer;
      color:var(--muted);
      font-weight:900;
      font-size:13px;
      list-style:none;
    }
    summary::-webkit-details-marker{display:none}

    .qedit{ margin-top:10px; }
    .qedit textarea{ min-height:160px; }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top:10px;
    }

    .row input{
      flex:1;
      min-width:240px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(0,0,0,.10);
      background:rgba(255,255,255,.92);
      color:var(--text);
      outline:none;
      font-size:13px;
    }

    .row input:focus{
      border-color:rgba(209,43,43,.45);
      box-shadow: 0 0 0 3px rgba(209,43,43,.14);
    }

    /* roundRect polyfill fallback for older browsers */
    canvas { display:none; }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <h1 class="title">ì˜¬í•´ì˜ 00 ê²°ì‚° ë„ìš°ë¯¸</h1>
        <p class="subtitle">ì§ˆë¬¸ì„ í•˜ë‚˜ì”© ë˜ì ¸ì£¼ê³ , ë‹µì„ ëª¨ì•„ í•œ ë²ˆì— ì •ë¦¬í•´ì£¼ëŠ” ê²°ì‚° í˜ì´ì§€ (íŒ¨ìŠ¤/ì¤‘ë‹¨/ë³µì‚¬/ì¸ìŠ¤íƒ€ ì¹´ë“œ PNG)</p>
      </div>
      <div class="pill" id="yearPill">ğŸ <span id="yearText"></span> ì—°ë§ ê²°ì‚°</div>
    </header>

    <div class="grid">
      <!-- Left -->
      <section class="card" id="flowCard">
        <div class="head">
          <h2 id="modeTitle">ì§„í–‰</h2>
          <div class="pill">âŒ¨ï¸ <code>Ctrl</code>+<code>Enter</code> ë‹¤ìŒ</div>
        </div>
        <div class="body">
          <div class="progress">
            <div class="bar"><i id="barFill"></i></div>
            <div class="pct" id="pctText">0% Â· 0/0</div>
          </div>

          <div class="qbox">
            <div class="qnum" id="qNum">Q1</div>
            <p class="qtext" id="qText">ì§ˆë¬¸ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>
          </div>

          <textarea id="answer" placeholder="ì—¬ê¸°ì— ë‹µì„ ì…ë ¥í•´ì¤˜. (ë¹„ì›Œë‘ê³  ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°€ë©´ â€˜íŒ¨ìŠ¤â€™ë¡œ ì²˜ë¦¬ë¼)"></textarea>
          <div class="hint">
            <span>íŒ: ë‹µì´ ê¸¸ì–´ë„ ê´œì°®ì•„. ì¤„ë°”ê¿ˆ ê·¸ëŒ€ë¡œ ì €ì¥ë¼.</span>
            <span>íŒ¨ìŠ¤ëŠ” <code>ë‹¤ìŒ</code>ë§Œ ëˆŒëŸ¬ë„ OK</span>
          </div>

          <div class="btns">
            <button class="primary" id="nextBtn">ë‹¤ìŒ</button>
            <button id="skipBtn">íŒ¨ìŠ¤</button>
            <button class="danger" id="stopBtn">ì—¬ê¸°ì„œ ë©ˆì¶”ê³  ê²°ì‚° ë³´ê¸°</button>
            <button class="ghost" id="restartBtn" title="ë‹µë³€ì€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤">ì²˜ìŒë¶€í„° ë‹¤ì‹œ</button>
          </div>

          <details>
            <summary>âš™ï¸ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ (ì§ˆë¬¸/ì œëª© ë°”ê¾¸ê¸°)</summary>
            <div class="qedit">
              <p class="small">
                - ìœ„ ì œëª©ì„ ë°”ê¾¸ë©´ í˜ì´ì§€ íƒ€ì´í‹€ë„ í•¨ê»˜ ë°”ë€œ<br/>
                - ì§ˆë¬¸ì€ ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„ (ë¹ˆ ì¤„ ë¬´ì‹œ)
              </p>
              <div class="row">
                <input id="customTitle" placeholder="ì˜ˆ: ì˜¬í•´ì˜ ê¸°ë¡ / ì˜¬í•´ì˜ ê°ì‚¬ / ì˜¬í•´ì˜ ì†Œë¹„" />
                <button id="applyTitleBtn">ì œëª© ì ìš©</button>
              </div>
              <textarea id="questionsEditor"></textarea>
              <div class="row">
                <button id="applyQuestionsBtn">ì§ˆë¬¸ ì ìš© (ì§„í–‰ ì´ˆê¸°í™”)</button>
                <button id="resetQuestionsBtn">ê¸°ë³¸ ì§ˆë¬¸ìœ¼ë¡œ ë³µì›</button>
              </div>
              <p class="small">* ì„œë²„ ì—†ì´ ë™ì‘: ì§„í–‰ ìƒíƒœëŠ” ë‚´ ë¸Œë¼ìš°ì €(localStorage)ì—ë§Œ ì €ì¥ë¼.</p>
            </div>
          </details>
        </div>
      </section>

      <!-- Right -->
      <aside class="card" id="summaryCard">
        <div class="head">
          <h2>ì§€ê¸ˆê¹Œì§€ ë‹µë³€</h2>
          <div class="pill">ğŸ§¾ ìë™ ìš”ì•½</div>
        </div>
        <div class="body">
          <div class="side-list" id="sideList"></div>

          <div class="footer-tools">
            <button id="copyAllBtn">ì „ì²´ ë³µì‚¬</button>
            <button id="copyNumberedBtn">ë²ˆí˜¸ ë¦¬ìŠ¤íŠ¸ë¡œ ë³µì‚¬</button>
            <button class="ghost" id="copyAnsweredOnlyBtn">ë‹µë³€í•œ ê²ƒë§Œ ë³µì‚¬</button>
            <button class="primary" id="exportImageBtn" title="ë‹µë³€ ì¤‘ ì¼ë¶€ë¥¼ ê³¨ë¼ 1080x1080 ì¸ìŠ¤íƒ€ ì¹´ë“œ PNGë¡œ ì €ì¥">ğŸ“¸ ì¸ìŠ¤íƒ€ ì¹´ë“œ ë§Œë“¤ê¸°</button>
          </div>
          <p class="small">* ë³µì‚¬ëŠ” í´ë¦½ë³´ë“œë¡œ, ì¸ìŠ¤íƒ€ ì¹´ë“œëŠ” PNGë¡œ ë‹¤ìš´ë¡œë“œë¼.</p>
        </div>
      </aside>
    </div>
  </div>

  <div class="toast" id="toast">
    <span class="dot"></span>
    <span id="toastText">ë³µì‚¬ ì™„ë£Œ!</span>
  </div>

<script>
(() => {
  // ====== ê¸°ë³¸ ì§ˆë¬¸ ì„¸íŠ¸ ======
  const DEFAULT_QUESTIONS = [
    "ì˜¬í•´ì˜ ìœ íŠœë¸ŒëŠ”?",
    "ì˜¬í•´ì˜ ë°°ìš°ëŠ”?",
    "ì˜¬í•´ì˜ ì˜í™”ëŠ”?",
    "ì˜¬í•´ì˜ ì•¨ë²”ì€?",
    "ì˜¬í•´ì˜ ë…¸ë˜ëŠ”?",
    "ì˜¬í•´ì˜ ë“œë¼ë§ˆëŠ”?",
    "ì˜¬í•´ì˜ ì „ì‹œëŠ”?",
    "ì˜¬í•´ì˜ ì±…ì€?",
    "ì˜¬í•´ì˜ ì„œì ì€?",
    "ì˜¬í•´ì˜ ì‘ê°€ëŠ”?",
    "ì˜¬í•´ì˜ ë¬¸ì¥ì€?",
    "ì˜¬í•´ì˜ ë§ì€?",
    "ì˜¬í•´ì˜ ìƒ‰ê¹”ì€?",
    "ì˜¬í•´ì˜ í’ê²½ì€?",
    "ì˜¬í•´ì˜ ë‚˜ë¬´ëŠ”?",
    "ì˜¬í•´ì˜ ìƒˆëŠ”?",
    "ì˜¬í•´ì˜ ìˆ²ì€?",
    "ì˜¬í•´ì˜ ì—¬í–‰ì€?",
    "ì˜¬í•´ì˜ ë‹¬ë¦¬ê¸°ëŠ”?",
    "ì˜¬í•´ì˜ ìˆœê°„ì€?",
    "ì˜¬í•´ì˜ ì²˜ìŒì€?",
    "ì˜¬í•´ì˜ ëì€?",
    "ì˜¬í•´ì˜ ìŒì‹ì€?",
    "ì˜¬í•´ì˜ ë””ì €íŠ¸ëŠ”?",
    "ì˜¬í•´ì˜ ìŒë£ŒëŠ”?",
    "ì˜¬í•´ì˜ ì»¤í”¼ëŠ”?",
    "ì˜¬í•´ì˜ ì‹ë‹¹ì€?",
    "ì˜¬í•´ì˜ í…Œì´í¬ì•„ì›ƒì€?",
    "ì˜¬í•´ì˜ ë§¤ìš´ ë§›ì€?",
    "ì˜¬í•´ì˜ ì†Œë¹„ëŠ”?",
    "ì˜¬í•´ì˜ íˆ¬ìëŠ”?",
    "ì˜¬í•´ì˜ ì†ì‹¤ì€?",
    "ì˜¬í•´ì˜ ë“í…œì€?",
    "ì˜¬í•´ì˜ êµ¬ë…ì€?",
    "ì˜¬í•´ì˜ ë¸Œëœë“œëŠ”?",
    "ì˜¬í•´ì˜ ì‹ ë°œì€?",
    "ì˜¬í•´ì˜ í‹°ì…”ì¸ ëŠ”?",
    "ì˜¬í•´ì˜ ì˜·ì€?",
    "ì˜¬í•´ì˜ ì•Œì½œì€?",
    "ì˜¬í•´ì˜ ìš´ë™ì€?",
    "ì˜¬í•´ì˜ ê±´ê°•ê´€ë¦¬ëŠ”?",
    "ì˜¬í•´ì˜ ê´€ë¦¬ëŠ”?",
    "ì˜¬í•´ì˜ ìŠµê´€ì€?",
    "ì˜¬í•´ì˜ ë™ë„¤ëŠ”?",
    "ì˜¬í•´ì˜ ê³µê°„ì€?",
    "ì˜¬í•´ì˜ ì§‘ì€?",
    "ì˜¬í•´ì˜ ì´ë™ìˆ˜ë‹¨ì€?",
    "ì˜¬í•´ì˜ ì‚°ì±…ë¡œëŠ”?",
    "ì˜¬í•´ì˜ ì‚°ì€?",
    "ì˜¬í•´ì˜ ë‹¤ë¦¬ëŠ”?",
    "ì˜¬í•´ì˜ ë™ë£ŒëŠ”?",
    "ì˜¬í•´ì˜ ë™ì—­ìëŠ”?",
    "ì˜¬í•´ì˜ ë„ì›€ì€?",
    "ì˜¬í•´ì˜ í˜¸ìŠ¤íŠ¸ëŠ”?",
    "ì˜¬í•´ì˜ ì‚¬ì¥ë‹˜ì€?",
    "ì˜¬í•´ì˜ ì…€ëŸ½ì€?",
    "ì˜¬í•´ì˜ ì§ê¿ì€?",
    "ì˜¬í•´ì˜ ì¬ë°œê²¬ì€?",
    "ì˜¬í•´ì˜ ë°œê²¬ì€?",
    "ì˜¬í•´ì˜ ê°ì‚¬ëŠ”?",
    "ì˜¬í•´ì˜ ë‚˜ëˆ”ì€?",
    "ì˜¬í•´ì˜ ì„ ë¬¼ì€?",
    "ì˜¬í•´ì˜ ì„±ì·¨ëŠ”?",
    "ì˜¬í•´ì˜ ë„ì „ì€?",
    "ì˜¬í•´ì˜ í”„ë¡œì íŠ¸ëŠ”?",
    "ì˜¬í•´ì˜ í¬ê¸°ëŠ”?",
    "ì˜¬í•´ì˜ ë°œì „ì€?",
    "ì˜¬í•´ì˜ í‡´ë³´ëŠ”?",
    "ì˜¬í•´ì˜ ì•¼ê·¼ì€?",
    "ì˜¬í•´ì˜ ê¸°ëŠ¥ì€?",
    "ì˜¬í•´ì˜ ì–´í”Œì€?",
    "ì˜¬í•´ì˜ ê¸°ì¨/í–‰ë³µì€?",
    "ì˜¬í•´ì˜ ë¿Œë“¯í•¨ì€?",
    "ì˜¬í•´ì˜ ë°•ì¥ëŒ€ì†ŒëŠ”?",
    "ì˜¬í•´ì˜ ì¬ë¯¸ëŠ”?",
    "ì˜¬í•´ì˜ ë‚­ë§Œì€?",
    "ì˜¬í•´ì˜ í‰í™”ëŠ”?",
    "ì˜¬í•´ì˜ ê°ë™ì€?",
    "ì˜¬í•´ì˜ í¬ì—´ì€?",
    "ì˜¬í•´ì˜ ë†€ëŒì€?",
    "ì˜¬í•´ì˜ ì„œí”„ë¼ì´ì¦ˆëŠ”?",
    "ì˜¬í•´ì˜ ì˜ì™¸ëŠ”?",
    "ì˜¬í•´ì˜ ì°¨ê°€ì›€ì€?",
    "ì˜¬í•´ì˜ ëœ¨ê±°ì›€ì€?",
    "ì˜¬í•´ì˜ ì ˆë§ì€?",
    "ì˜¬í•´ì˜ ê³ ë‚œì€?",
    "ì˜¬í•´ì˜ ê³ í†µì€?",
    "ì˜¬í•´ì˜ ìŠ¬í””ì€?",
    "ì˜¬í•´ì˜ ë¶„ë…¸ëŠ”?",
    "ì˜¬í•´ì˜ ì•„ì°”í•¨ì€?",
    "ì˜¬í•´ì˜ ì¶©ê²©ì€?",
    "ì˜¬í•´ì˜ ê±±ì •ì€?",
    "ì˜¬í•´ì˜ ê³ ë¯¼ì€?",
    "ì˜¬í•´ì˜ ì§‘ì°©ì€?",
    "ì˜¬í•´ì˜ íì§€ë¶€ì§€ëŠ”?",
    "ì˜¬í•´ì˜ í›„íšŒëŠ”?",
    "ì˜¬í•´ì˜ ì£„ì†¡ì€?",
    "ì˜¬í•´ì˜ ë‚­ë¹„ëŠ”?",
    "ì˜¬í•´ì˜ ë¶„ì‹¤ì€?",
    "ì˜¬í•´ì˜ ì‹¤íŒ¨ëŠ”?",
    "ì˜¬í•´ì˜ ì‹¤ìˆ˜ëŠ”?",
    "ì˜¬í•´ì˜ ë’·ë¶ì€?",
    "ì˜¬í•´ì˜ ìŒ¤í†µì€?",
    "ì˜¬í•´ì˜ ìµœê³  í‚¹ë°›ëŠ” ìˆœê°„ì€?",
    "ì˜¬í•´ì˜ ì½”í”¼ëŠ”?",
    "ì˜¬í•´ì˜ ì§„ë•€ì€?",
    "ì˜¬í•´ì˜ ìš°ì—°ì€?",
    "ì˜¬í•´ì˜ ë§Œë‚¨ì€?",
    "ì˜¬í•´ì˜ í¸ì§€ëŠ”?",
    "ì˜¬í•´ì˜ ì² í•™ì€?",
    "ì˜¬í•´ì˜ ì‹¬ê²½ë³€í™”ëŠ”?",
    "ì˜¬í•´ì˜ ì„±ì¥(ë°°ì›€)ì€?",
    "ì˜¬í•´ì˜ ì˜ê°ì€?",
    "ì˜¬í•´ì˜ ê°•ì—°ì€?",
    "ì˜¬í•´ì˜ ì˜ˆë°°ëŠ”?",
    "ì˜¬í•´ì˜ ì°¬ì–‘ì€?",
    "ì˜¬í•´ì˜ ë§ì”€ì€?",
    "ì˜¬í•´ì˜ ì„ êµëŠ”?",
    "ì˜¬í•´ì˜ ìˆ˜ì§‘ì€?",
    "ì˜¬í•´ì˜ ìƒë‹´ì€?",
    "ì˜¬í•´ì˜ í´ë˜ìŠ¤ëŠ”?",
    "ì˜¬í•´ì˜ í‹°ë¹„ì¶œì—°ì€?",
    "ì˜¬í•´ì˜ ì…€ì¹´ëŠ”?",
    "ì˜¬í•´ì˜ ê·€ì—¬ì›€ì€?",
    "ì˜¬í•´ì˜ ë¼ì§€ëŠ”?",
    "ì˜¬í•´ì˜ ë‹¹ê·¼ì€?"
  ];

  const LS_KEY = "year_review_helper_redwhite_v1";

  // ====== DOM ======
  const yearText = document.getElementById("yearText");
  const modeTitle = document.getElementById("modeTitle");
  const barFill = document.getElementById("barFill");
  const pctText = document.getElementById("pctText");
  const qNum = document.getElementById("qNum");
  const qText = document.getElementById("qText");
  const answerEl = document.getElementById("answer");
  const sideList = document.getElementById("sideList");

  const nextBtn = document.getElementById("nextBtn");
  const skipBtn = document.getElementById("skipBtn");
  const stopBtn = document.getElementById("stopBtn");
  const restartBtn = document.getElementById("restartBtn");

  const copyAllBtn = document.getElementById("copyAllBtn");
  const copyNumberedBtn = document.getElementById("copyNumberedBtn");
  const copyAnsweredOnlyBtn = document.getElementById("copyAnsweredOnlyBtn");
  const exportImageBtn = document.getElementById("exportImageBtn");

  const toast = document.getElementById("toast");
  const toastText = document.getElementById("toastText");

  const customTitle = document.getElementById("customTitle");
  const applyTitleBtn = document.getElementById("applyTitleBtn");
  const questionsEditor = document.getElementById("questionsEditor");
  const applyQuestionsBtn = document.getElementById("applyQuestionsBtn");
  const resetQuestionsBtn = document.getElementById("resetQuestionsBtn");

  // ====== Year ======
  const now = new Date();
  const YEAR = now.getFullYear();
  yearText.textContent = YEAR;

  // ====== Utils ======
  function showToast(msg){
    toastText.textContent = msg;
    toast.style.display = "inline-flex";
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=> toast.style.display = "none", 1600);
  }

  function safeParseJSON(s){ try { return JSON.parse(s); } catch { return null; } }
  function save(state){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }
  function load(){
    const raw = localStorage.getItem(LS_KEY);
    return raw ? safeParseJSON(raw) : null;
  }
  function normalizeQuestions(text){
    return text.split("\n").map(s => s.trim()).filter(s => s.length > 0);
  }
  function esc(s){
    return (s ?? "").replace(/[&<>"']/g, (m) => ({
      "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
    })[m]);
  }

  // ====== State ======
  let state = load() || {
    title: "ì˜¬í•´ì˜ 00 ê²°ì‚° ë„ìš°ë¯¸",
    questions: DEFAULT_QUESTIONS,
    idx: 0,
    answers: {},     // { [index]: string }
    skipped: {},     // { [index]: true }
    stoppedAt: null
  };

  // ====== Render ======
  function setPageTitle(){
    document.title = state.title;
    document.querySelector(".title").textContent = state.title;
  }

  function renderEditor(){
    customTitle.value = state.title;
    questionsEditor.value = state.questions.join("\n");
  }

  function renderProgress(){
    const total = state.questions.length;
    const doneCount = Object.keys(state.answers).length + Object.keys(state.skipped).length;
    const pct = total ? Math.round((doneCount / total) * 100) : 0;
    barFill.style.width = `${pct}%`;
    pctText.textContent = `${pct}% Â· ${doneCount}/${total}`;
  }

  function renderQuestion(){
    const total = state.questions.length;
    const isFinished = state.idx >= total;

    if(isFinished){
      modeTitle.textContent = "ê²°ì‚° ì™„ë£Œ";
      qNum.textContent = "DONE";
      qText.textContent = "ê²°ì‚°ì™„ë£Œ! ì˜¤ë¥¸ìª½ì—ì„œ ë‹µë³€ì„ í™•ì¸í•˜ê³  ë³µì‚¬/ì¸ìŠ¤íƒ€ ì¹´ë“œ(PNG)ë¡œ ì €ì¥í•´ì¤˜.";
      answerEl.value = "";
      answerEl.disabled = true;
      nextBtn.disabled = true;
      skipBtn.disabled = true;
      stopBtn.disabled = true;
      return;
    }

    modeTitle.textContent = "ì§„í–‰";
    answerEl.disabled = false;
    nextBtn.disabled = false;
    skipBtn.disabled = false;
    stopBtn.disabled = false;

    qNum.textContent = `Q${state.idx + 1}/${total}`;
    qText.textContent = state.questions[state.idx];

    const existing = state.answers[state.idx] ?? "";
    answerEl.value = existing;
    setTimeout(() => answerEl.focus(), 0);
  }

  function renderSideList(){
    const total = state.questions.length;
    const rows = [];
    for(let i=0;i<total;i++){
      const q = state.questions[i];
      const a = state.answers[i];
      const isSkip = !!state.skipped[i] && (!a || a.trim()==="");
      const tag = a && a.trim() ? "ë‹µë³€" : (isSkip ? "íŒ¨ìŠ¤" : "ë¯¸ì‘ë‹µ");
      const ansHtml =
        (a && a.trim())
          ? `<p class="ans">${esc(a)}</p>`
          : `<p class="ans empty">${isSkip ? "íŒ¨ìŠ¤ ì²˜ë¦¬ë¨" : "ì•„ì§ ë‹µë³€ ì—†ìŒ"}</p>`;

      rows.push(`
        <div class="item">
          <div class="meta">
            <b>${esc(`Q${i+1}. ${q}`)}</b>
            <span class="tag">${esc(tag)}</span>
          </div>
          ${ansHtml}
        </div>
      `);
    }
    sideList.innerHTML = rows.join("");

    const answeredCount = Object.keys(state.answers).filter(k => (state.answers[k] ?? "").trim().length > 0).length;
    exportImageBtn.disabled = answeredCount === 0;
  }

  function renderAll(){
    setPageTitle();
    renderEditor();
    renderProgress();
    renderQuestion();
    renderSideList();
  }

  // ====== Actions ======
  function setAnswerAndAdvance({skip=false} = {}){
    const total = state.questions.length;
    if(state.idx >= total) return;

    const val = (answerEl.value ?? "").trimEnd();
    if(skip){
      delete state.answers[state.idx];
      state.skipped[state.idx] = true;
    }else{
      if(val.trim() === ""){
        delete state.answers[state.idx];
        state.skipped[state.idx] = true;
      }else{
        state.answers[state.idx] = val;
        delete state.skipped[state.idx];
      }
    }

    state.idx += 1;
    save(state);
    renderAll();
  }

  function stopAndShow(){
    state.stoppedAt = state.idx;

    const val = (answerEl.value ?? "").trimEnd();
    if(val.trim()===""){
      delete state.answers[state.idx];
      state.skipped[state.idx] = true;
    }else{
      state.answers[state.idx] = val;
      delete state.skipped[state.idx];
    }

    state.idx = state.questions.length;
    save(state);
    renderAll();
    showToast("ê²°ì‚° í™”ë©´ìœ¼ë¡œ ì´ë™!");
  }

  function restart(){
    state.idx = 0;
    state.answers = {};
    state.skipped = {};
    state.stoppedAt = null;
    save(state);
    renderAll();
    showToast("ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘!");
  }

  function buildText({numbered=false, answeredOnly=false} = {}){
    const lines = [];
    const total = state.questions.length;

    for(let i=0;i<total;i++){
      const q = state.questions[i];
      const a = (state.answers[i] ?? "").trim();
      const isSkip = !!state.skipped[i] && !a;

      if(answeredOnly && !a) continue;

      if(numbered){
        if(a){
          lines.push(`${i+1}) ${q} - ${a}`);
        }else{
          lines.push(`${i+1}) ${q} - ${isSkip ? "(íŒ¨ìŠ¤)" : "(ë¯¸ì‘ë‹µ)"}`);
        }
      }else{
        lines.push(`Q${i+1}. ${q}`);
        lines.push(`A${i+1}. ${a ? a : (isSkip ? "(íŒ¨ìŠ¤)" : "(ë¯¸ì‘ë‹µ)")}`);
        lines.push("");
      }
    }

    return lines.join("\n").trim() + "\n";
  }

  async function copyToClipboard(text){
    try{
      await navigator.clipboard.writeText(text);
      showToast("ë³µì‚¬ ì™„ë£Œ!");
    }catch(e){
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      ta.remove();
      showToast("ë³µì‚¬ ì™„ë£Œ! (fallback)");
    }
  }

  // ====== Events ======
  nextBtn.addEventListener("click", () => setAnswerAndAdvance({skip:false}));
  skipBtn.addEventListener("click", () => setAnswerAndAdvance({skip:true}));
  stopBtn.addEventListener("click", stopAndShow);
  restartBtn.addEventListener("click", restart);

  copyAllBtn.addEventListener("click", () => copyToClipboard(buildText({numbered:false, answeredOnly:false})));
  copyNumberedBtn.addEventListener("click", () => copyToClipboard(buildText({numbered:true, answeredOnly:false})));
  copyAnsweredOnlyBtn.addEventListener("click", () => copyToClipboard(buildText({numbered:true, answeredOnly:true})));

  answerEl.addEventListener("keydown", (e) => {
    if((e.ctrlKey || e.metaKey) && e.key === "Enter"){
      e.preventDefault();
      setAnswerAndAdvance({skip:false});
    }
  });

  applyTitleBtn.addEventListener("click", () => {
    const t = (customTitle.value ?? "").trim();
    state.title = t.length ? t : "ì˜¬í•´ì˜ 00 ê²°ì‚° ë„ìš°ë¯¸";
    save(state);
    renderAll();
    showToast("ì œëª© ì ìš© ì™„ë£Œ!");
  });

  applyQuestionsBtn.addEventListener("click", () => {
    const qs = normalizeQuestions(questionsEditor.value ?? "");
    if(qs.length < 1){
      showToast("ì§ˆë¬¸ì´ ìµœì†Œ 1ê°œëŠ” í•„ìš”í•´!");
      return;
    }
    state.questions = qs;
    state.idx = 0;
    state.answers = {};
    state.skipped = {};
    state.stoppedAt = null;
    save(state);
    renderAll();
    showToast("ì§ˆë¬¸ ì ìš© & ì´ˆê¸°í™” ì™„ë£Œ!");
  });

  resetQuestionsBtn.addEventListener("click", () => {
    questionsEditor.value = DEFAULT_QUESTIONS.join("\n");
    showToast("ê¸°ë³¸ ì§ˆë¬¸ìœ¼ë¡œ ë³µì›!");
  });

  // =============================
  // ğŸ“¸ ì¸ìŠ¤íƒ€ ì¹´ë“œ ì´ë¯¸ì§€ ìƒì„± (1080x1080 PNG) - Red/White
  // =============================
  exportImageBtn.addEventListener("click", generateInstagramCard);

  function generateInstagramCard(){
    const SIZE = 1080;
    const PAD = 86;

    const answered = Object.keys(state.answers)
      .map(k => Number(k))
      .filter(i => (state.answers[i] ?? "").trim().length > 0)
      .map(i => ({ q: state.questions[i], a: String(state.answers[i]) }));

    if(answered.length === 0){
      showToast("ì•„ì§ ë‹µë³€ì´ ì—†ì–´! í•œ ê°œë¼ë„ ì‘ì„±í•´ì¤˜.");
      return;
    }

    shuffle(answered);
    const picks = answered.slice(0, Math.min(7, answered.length));

    const canvas = document.createElement("canvas");
    canvas.width = SIZE;
    canvas.height = SIZE;
    const ctx = canvas.getContext("2d");

    // ë°°ê²½: í™”ì´íŠ¸ + ë ˆë“œ ë¦¬ë³¸ ë¼ì¸ + ìŠ¤ë…¸ìš° ë„íŠ¸ ëŠë‚Œ
    ctx.fillStyle = "#fff6f7";
    ctx.fillRect(0, 0, SIZE, SIZE);

    // ë¦¬ë³¸ ë¼ì¸
    ctx.strokeStyle = "rgba(209,43,43,0.10)";
    ctx.lineWidth = 12;
    for(let y=110; y<SIZE; y+=240){
      ctx.beginPath();
      ctx.moveTo(0, y);
      ctx.lineTo(SIZE, y);
      ctx.stroke();
    }

    // ìŠ¤ë…¸ìš° ë„íŠ¸
    ctx.fillStyle = "rgba(255,255,255,0.95)";
    for(let i=0;i<65;i++){
      const x = Math.random() * SIZE;
      const y = Math.random() * SIZE;
      const r = 1.5 + Math.random()*2.2;
      ctx.beginPath();
      ctx.arc(x,y,r,0,Math.PI*2);
      ctx.fill();
    }

    // ì¹´ë“œ ì™¸ê³½
    roundRect(ctx, 44, 44, SIZE-88, SIZE-88, 28);
    ctx.strokeStyle = "rgba(0,0,0,0.10)";
    ctx.lineWidth = 2;
    ctx.stroke();

    // íƒ€ì´í‹€
    ctx.fillStyle = "#1b1b1b";
    ctx.textAlign = "left";
    ctx.font = "900 56px sans-serif";
    ctx.fillText(`${YEAR} ì˜¬í•´ì˜ ê²°ì‚°`, PAD, 150);

    ctx.font = "600 28px sans-serif";
    ctx.fillStyle = "rgba(0,0,0,0.55)";
    ctx.fillText(state.title, PAD, 200);

    let y = 285;
    const maxWidth = SIZE - PAD*2;

    for(const {q, a} of picks){
      ctx.font = "900 30px sans-serif";
      ctx.fillStyle = "#d12b2b";
      y = wrapText(ctx, `â€¢ ${q}`, PAD, y, maxWidth, 40);

      ctx.font = "500 28px sans-serif";
      ctx.fillStyle = "#1b1b1b";
      y = wrapText(ctx, a, PAD + 18, y + 6, maxWidth - 18, 38);

      y += 20;
      if(y > SIZE - 180) break;
    }

    // í•˜ë‹¨
    ctx.fillStyle = "rgba(0,0,0,0.55)";
    ctx.font = "600 24px sans-serif";
    ctx.fillText(`Â© ${YEAR}`, PAD, SIZE - 92);

    ctx.textAlign = "right";
    ctx.fillText(`#ì—°ë§ê²°ì‚° #ì˜¬í•´ì˜`, SIZE - PAD, SIZE - 92);

    const link = document.createElement("a");
    link.download = `ì˜¬í•´ì˜_ê²°ì‚°_${YEAR}_redwhite.png`;
    link.href = canvas.toDataURL("image/png");
    link.click();

    showToast("ì¸ìŠ¤íƒ€ ì¹´ë“œ PNG ìƒì„±!");
  }

  function shuffle(arr){
    for(let i = arr.length - 1; i > 0; i--){
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }

  function wrapText(ctx, text, x, y, maxWidth, lineHeight){
    const hard = String(text).split("\n");
    for(const block of hard){
      const words = block.split(" ");
      let line = "";

      for(let n=0; n<words.length; n++){
        const testLine = line + words[n] + " ";
        const metrics = ctx.measureText(testLine);
        if(metrics.width > maxWidth && n > 0){
          ctx.fillText(line.trimEnd(), x, y);
          line = words[n] + " ";
          y += lineHeight;
        }else{
          line = testLine;
        }
      }
      ctx.fillText(line.trimEnd(), x, y);
      y += lineHeight;
    }
    return y;
  }

  // roundRect helper (ì§€ì› ì•ˆ ë˜ë©´ ì§ì ‘ path)
  function roundRect(ctx, x, y, w, h, r){
    r = Math.min(r, w/2, h/2);
    if (typeof ctx.roundRect === "function"){
      ctx.beginPath();
      ctx.roundRect(x, y, w, h, r);
      ctx.closePath();
      return;
    }
    ctx.beginPath();
    ctx.moveTo(x + r, y);
    ctx.arcTo(x + w, y, x + w, y + h, r);
    ctx.arcTo(x + w, y + h, x, y + h, r);
    ctx.arcTo(x, y + h, x, y, r);
    ctx.arcTo(x, y, x + w, y, r);
    ctx.closePath();
  }

  // ====== Start ======
  renderAll();
})();
</script>
</body>
</html>
